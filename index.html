<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mudanya Jandarma Sosyal Tesisleri</title>
    
    <!-- Tailwind CSS (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">

    <!-- Tailwind Konfigürasyonu -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            blue: '#004aad',   /* Jandarma Mavisi */
                            gold: '#d4af37',   /* Altın Sarısı */
                            dark: '#1e293b',
                            light: '#f8fafc',
                            red: '#e11d48'
                        },
                    },
                    boxShadow: {
                        'soft': '0 4px 20px -2px rgba(0, 0, 0, 0.05)',
                        'up': '0 -4px 20px -2px rgba(0, 0, 0, 0.1)',
                    },
                    animation: {
                        'bounce-slow': 'bounce 2s infinite',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>

    <style>
        /* Özel Kaydırma Çubuğu Gizleme */
        .hide-scroll::-webkit-scrollbar { display: none; }
        .hide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Animasyonlar */
        .fade-in-up { animation: fadeInUp 0.5s ease-out forwards; }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Modal Animasyonu */
        .modal-enter { animation: modalIn 0.3s ease-out forwards; }
        @keyframes modalIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        /* Info Bar Genişleme Animasyonu */
        #infoDetails { transition: max-height 0.3s ease-out, opacity 0.3s ease-out; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 antialiased pb-24 selection:bg-brand-blue selection:text-white">

    <!-- ÜST HEADER (Sabit) -->
    <header class="sticky top-0 z-40 bg-white/95 backdrop-blur-md border-b border-slate-200 shadow-sm transition-all duration-300" id="mainHeader">
        
        <!-- DUYURU ALANI (En üstte görünür) -->
        <div id="topAnnouncement" class="hidden bg-brand-red text-white text-xs font-bold px-4 py-2 text-center animate-pulse-slow relative">
            <i class="fas fa-bullhorn mr-2"></i>
            <span id="topAnnouncementText"></span>
        </div>

        <div class="max-w-3xl mx-auto px-4 pt-3 pb-1">
            
            <!-- Logolar ve Başlık -->
            <div class="flex items-center justify-between mb-3 relative">
                <!-- Logo Sol -->
                <div class="flex items-center gap-3">
                    <div class="relative w-12 h-12 flex items-center justify-center">
                        <img src="mudanya-tesis-logo.png" onerror="this.src='https://via.placeholder.com/100?text=Tesis'" alt="Tesis Logo" class="w-full h-full object-contain drop-shadow-sm">
                    </div>
                    <div class="h-8 w-px bg-slate-300 mx-1"></div>
                    <div class="ml-1 flex flex-col justify-center">
                        <h1 class="text-sm font-bold text-brand-blue leading-tight tracking-wide uppercase">JANDARMA SOSYAL TESİSLERİ</h1>
                        <span class="text-[10px] text-slate-500 font-semibold tracking-widest uppercase">MUDANYA</span>
                    </div>
                </div>

                <!-- Bilgi Butonu (Varsa görünür) -->
                <button id="infoBtn" onclick="openInfoModal()" class="hidden w-8 h-8 rounded-full bg-slate-100 text-brand-blue items-center justify-center hover:bg-brand-blue hover:text-white transition-colors">
                    <i class="fas fa-info text-sm"></i>
                </button>
            </div>

            <!-- KATEGORİ NAVİGASYONU -->
            <div class="relative -mx-4 px-4">
                <nav id="categoryNav" class="flex gap-2 overflow-x-auto hide-scroll pb-3 snap-x">
                    <!-- JS ile doldurulacak -->
                    <div class="h-9 w-20 bg-slate-200 rounded-full animate-pulse flex-shrink-0"></div>
                    <div class="h-9 w-24 bg-slate-200 rounded-full animate-pulse flex-shrink-0"></div>
                </nav>
                <div class="absolute right-0 top-0 h-full w-8 bg-gradient-to-l from-white/90 to-transparent pointer-events-none"></div>
            </div>
        </div>
    </header>

    <!-- ANA İÇERİK -->
    <main class="max-w-3xl mx-auto px-4 pt-4">
        
        <div id="errorArea" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-6 text-sm text-center"></div>

        <!-- BİLGİ ALANI (Info Bar - Saatler, Adres, Wifi) -->
        <div id="infoBarContainer" class="hidden mb-6 bg-white rounded-xl border border-slate-200 shadow-soft overflow-hidden">
            <!-- Başlık / Özet (Her zaman görünür) -->
            <div class="p-3 bg-brand-light border-b border-slate-100 flex justify-between items-center cursor-pointer group" onclick="toggleInfoDetails()">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded-full bg-blue-100 text-brand-blue flex items-center justify-center group-hover:bg-brand-blue group-hover:text-white transition-colors">
                         <i class="fas fa-clock text-sm"></i>
                    </div>
                    <div>
                        <div class="text-xs text-slate-500 font-semibold uppercase">Hizmet Bilgileri</div>
                        <div class="text-xs font-bold text-slate-800 mt-0.5">Saatler ve Adres için dokunun</div>
                    </div>
                </div>
                <i class="fas fa-chevron-down text-slate-400 transition-transform duration-300" id="infoChevron"></i>
            </div>

            <!-- Detaylar (Açılır/Kapanır) -->
            <div id="infoDetails" class="max-h-0 opacity-0 bg-slate-50">
                <div class="p-4 space-y-4 text-sm">
                    
                    <!-- Saatler Listesi -->
                    <div id="hoursArea" class="hidden">
                        <h4 class="text-xs font-bold text-slate-400 uppercase mb-2 tracking-wider">Hizmet Saatleri</h4>
                        <ul id="hoursList" class="space-y-2">
                            <!-- JS ile doldurulacak -->
                        </ul>
                    </div>

                    <div class="h-px bg-slate-200 w-full"></div>

                    <!-- Adres ve Yol Tarifi -->
                    <div class="flex flex-col gap-2">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-map-marker-alt text-brand-red w-5 text-center mt-1"></i>
                            <span class="text-slate-600 text-sm" id="addressText">-</span>
                        </div>
                        <!-- Yol Tarifi Butonu -->
                        <a id="mapsBtn" href="#" target="_blank" class="hidden ml-8 inline-flex items-center gap-2 text-xs font-bold text-brand-blue hover:underline">
                            <i class="fas fa-location-arrow"></i>
                            Google Maps'te Aç
                        </a>
                    </div>
                    
                    <!-- Wifi -->
                    <div id="wifiArea" class="hidden flex items-center gap-3 bg-white p-3 rounded-lg border border-slate-100">
                        <div class="w-8 h-8 bg-slate-100 rounded-full flex items-center justify-center text-brand-dark">
                            <i class="fas fa-wifi"></i>
                        </div>
                        <div>
                            <div class="text-xs text-slate-400 font-bold uppercase">Wi-Fi Şifresi</div>
                            <div class="text-base font-mono font-bold text-brand-blue tracking-wide select-all" id="wifiText">-</div>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <!-- Yükleniyor (Skeleton) -->
        <div id="loader" class="space-y-4">
            <div class="bg-white rounded-2xl p-3 shadow-sm border border-slate-100 flex gap-3 animate-pulse">
                <div class="w-24 h-24 bg-slate-200 rounded-xl flex-shrink-0"></div>
                <div class="flex-1 py-1 space-y-2">
                    <div class="h-4 bg-slate-200 rounded w-3/4"></div>
                    <div class="h-3 bg-slate-200 rounded w-full"></div>
                </div>
            </div>
        </div>

        <!-- ÜRÜN LİSTESİ -->
        <div id="menuContainer" class="space-y-8 min-h-[50vh]"></div>

    </main>

    <!-- YENİ: REZERVASYON BUTONU (Sticky FAB) -->
    <a id="fabCall" href="#" class="hidden fixed bottom-6 right-6 z-40 bg-brand-gold text-white rounded-full w-14 h-14 shadow-lg shadow-orange-200 items-center justify-center hover:scale-110 transition-transform duration-300 active:scale-95 animate-bounce-slow">
        <i class="fas fa-phone text-xl"></i>
    </a>

    <!-- FOOTER -->
    <footer class="mt-12 py-8 text-center border-t border-slate-200 bg-white">
        <div class="flex justify-center gap-4 mb-4 opacity-50">
             <i class="fas fa-utensils text-slate-400"></i>
             <i class="fas fa-coffee text-slate-400"></i>
        </div>
        <p class="text-slate-500 text-xs font-medium uppercase tracking-widest">Mudanya Jandarma Sosyal Tesisleri</p>
        <div id="footerContact" class="mt-2 text-xs text-slate-400 flex flex-col items-center gap-1">
            <!-- JS ile doldurulacak -->
        </div>
    </footer>

    <!-- MODAL 1: ÜRÜN DETAY (GÜNCELLENDİ: Esnek Resim) -->
    <div id="productModal" class="fixed inset-0 z-50 hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm transition-opacity" onclick="closeModal('productModal')"></div>
        
        <!-- items-end yerine items-center yaptık, böylece modal her zaman ekranın ortasında olur -->
        <div class="fixed inset-0 z-10 overflow-y-auto">
            <div class="flex min-h-full items-center justify-center p-4 text-center">
                
                <!-- max-h-[90vh] ve flex-col ekledik -->
                <div class="relative transform overflow-hidden rounded-2xl bg-white text-left shadow-2xl transition-all w-full max-w-lg modal-enter flex flex-col max-h-[90vh]">
                    
                    <!-- Kapat butonu (Hafif arka plan eklendi) -->
                    <button type="button" class="absolute top-3 right-3 z-20 bg-black/10 hover:bg-black/20 backdrop-blur-md rounded-full p-2 text-slate-600 hover:text-slate-800 transition-all shadow-sm border border-white/20" onclick="closeModal('productModal')">
                        <i class="fas fa-times text-lg w-5 h-5 flex items-center justify-center"></i>
                    </button>

                    <!-- GÜNCELLENEN KISIM: Resim Alanı -->
                    <div class="w-full bg-slate-50 relative flex justify-center items-center min-h-[200px]">
                         <!-- h-auto ve max-h-[50vh] ile dikey resimler ekranın yarısını geçemez ve object-contain ile kesilmez -->
                         <img id="modalImage" src="" alt="Ürün Detay" class="w-full h-auto max-h-[50vh] object-contain mx-auto" referrerpolicy="no-referrer">
                    </div>

                    <!-- İçerik (Kaydırılabilir) -->
                    <div class="p-6 overflow-y-auto">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="text-xl font-bold text-slate-900 leading-6 pr-4" id="modalTitle">Ürün Adı</h3>
                            <div class="text-lg font-bold text-brand-blue whitespace-nowrap" id="modalPrice">₺0</div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-slate-600 leading-relaxed" id="modalDesc">Ürün açıklaması.</p>
                        </div>
                        <div class="mt-6 pt-4 border-t border-slate-100 flex justify-center">
                            <button type="button" class="inline-flex w-full justify-center rounded-xl bg-brand-blue px-3 py-3 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 sm:w-auto" onclick="closeModal('productModal')">Kapat</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL 2: GENEL BİLGİLENDİRME -->
    <div id="infoModal" class="fixed inset-0 z-50 hidden" role="dialog" aria-modal="true">
        <div class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm transition-opacity" onclick="closeModal('infoModal')"></div>
        <div class="fixed inset-0 z-10 overflow-y-auto">
            <div class="flex min-h-full items-center justify-center p-4 text-center">
                <div class="relative transform overflow-hidden rounded-2xl bg-white text-left shadow-2xl transition-all w-full max-w-md modal-enter">
                    
                    <!-- Modal Header -->
                    <div class="bg-brand-blue px-4 py-4 flex justify-between items-center">
                        <h3 class="text-white font-bold text-lg flex items-center gap-2">
                            <i class="fas fa-info-circle"></i>
                            Genel Bilgilendirme
                        </h3>
                        <button type="button" class="text-white/80 hover:text-white" onclick="closeModal('infoModal')">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>

                    <!-- Modal Body -->
                    <div class="p-6 max-h-[70vh] overflow-y-auto">
                        <div class="prose prose-sm text-slate-600 leading-relaxed whitespace-pre-line" id="generalInfoText">
                            <!-- İçerik buraya gelecek -->
                        </div>
                    </div>

                    <!-- Modal Footer -->
                    <div class="bg-slate-50 px-4 py-3 flex justify-end">
                        <button type="button" class="rounded-lg bg-white border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-700 shadow-sm hover:bg-slate-50" onclick="closeModal('infoModal')">Tamam</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JAVASCRIPT -->
    <script>
        // --- KONFIGURASYON ---
        // ÖNEMLİ: Apps Script'ten aldığınız Web App URL'sini buraya tırnak içine yapıştırın.
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzRq8B59-xy8TWd_MveXQihtFXrecA14RgY6BDpWbz65eRdCzYgtvgOa-jZ_QSIQ5ly/exec';

        let allCategories = [];
        let allProducts = [];
        let appSettings = {};
        let activeCategoryID = 'all';

        document.addEventListener('DOMContentLoaded', () => {
            initApp();
        });

        async function initApp() {
            try {
                // Link girilmemişse uyarı
                if(GOOGLE_SCRIPT_URL.includes('BURAYA_APPS')) {
                     throw new Error("Lütfen index.html dosyasına Apps Script URL'sini ekleyin.");
                }

                // Google Script'ten veriyi JSON olarak çek
                const response = await fetch(GOOGLE_SCRIPT_URL);
                
                if (!response.ok) throw new Error('Sunucuya erişilemedi.');

                const data = await response.json();

                // Ayarları İşle
                processSettings(data.settings);
                renderSettingsUI();

                // Kategoriler ve Ürünleri İşle
                allCategories = data.categories
                    .filter(c => c['KategoriID'] && c['KategoriAdi'])
                    .sort((a, b) => (parseInt(a['Sira']) || 999) - (parseInt(b['Sira']) || 999));
                
                allProducts = data.products
                    .filter(p => p['UrunAdi'])
                    .sort((a, b) => (parseInt(a['UrunSirasi']) || 999) - (parseInt(b['UrunSirasi']) || 999));

                renderCategories();
                renderMenu('all');

                document.getElementById('loader').style.display = 'none';

            } catch (error) {
                console.error(error);
                document.getElementById('loader').style.display = 'none';
                const errDiv = document.getElementById('errorArea');
                errDiv.classList.remove('hidden');
                errDiv.innerHTML = `
                    <strong>Bağlantı Hatası:</strong> ${error.message}<br>
                    <span class="text-xs mt-2 block">Lütfen Apps Script URL'sini kontrol ediniz.</span>
                `;
            }
        }

        function convertGoogleDriveLink(link) {
            if (!link) return '';
            if (link.match(/\.(jpeg|jpg|gif|png|webp)$/i) != null) return link;
            if (link.includes('drive.google.com') || link.includes('docs.google.com')) {
                let id = '';
                const idMatch = link.match(/\/d\/([a-zA-Z0-9_-]+)/);
                const idParamMatch = link.match(/id=([a-zA-Z0-9_-]+)/);
                if (idMatch && idMatch[1]) id = idMatch[1];
                else if (idParamMatch && idParamMatch[1]) id = idParamMatch[1];
                if (id) return `https://drive.google.com/thumbnail?id=${id}&sz=w1000`;
            }
            return link;
        }

        // --- AYARLAR VE UI ---
        function processSettings(rawData) {
            appSettings = {};
            if(!rawData) return;
            
            rawData.forEach(item => {
                if(item['AyarAdi']) {
                    appSettings[item['AyarAdi']] = String(item['Deger']);
                }
            });
        }

        function renderSettingsUI() {
            // 1. TELEFON (FAB)
            const phone = appSettings['Telefon'];
            const fabCall = document.getElementById('fabCall');
            if (phone) {
                fabCall.href = `tel:${phone.replace(/\s/g, '')}`;
                fabCall.classList.remove('hidden');
                fabCall.classList.add('flex');
            }

            // 2. DUYURU (En Üst)
            const announcement = appSettings['Duyuru'];
            if (announcement) {
                const annDiv = document.getElementById('topAnnouncement');
                annDiv.classList.remove('hidden');
                document.getElementById('topAnnouncementText').textContent = announcement;
            }

            // 3. GENEL BİLGİLENDİRME (Modal Butonu)
            const generalInfo = appSettings['GenelAciklama'];
            if (generalInfo) {
                document.getElementById('infoBtn').classList.remove('hidden');
                document.getElementById('infoBtn').classList.add('flex');
                document.getElementById('generalInfoText').textContent = generalInfo;
            }

            // 4. İNFO BAR DETAYLARI
            const hoursRaw = appSettings['HizmetSaatleri'];
            const address = appSettings['Adres'];
            const wifi = appSettings['WifiSifresi'];
            const mapsLink = appSettings['GoogleMapsLink'];

            // Eğer herhangi biri doluysa paneli göster
            if (hoursRaw || address || wifi) {
                document.getElementById('infoBarContainer').classList.remove('hidden');
            }

            // -- Saatleri Parçala ve Listele --
            if (hoursRaw) {
                document.getElementById('hoursArea').classList.remove('hidden');
                const hoursListUl = document.getElementById('hoursList');
                hoursListUl.innerHTML = '';
                
                // | işareti veya yeni satıra göre böl
                const parts = hoursRaw.split(/[|\n]/);
                
                parts.forEach(part => {
                    const cleanPart = part.trim();
                    if(cleanPart) {
                        const li = document.createElement('li');
                        li.className = "flex items-center gap-2 text-slate-700";
                        li.innerHTML = `<div class="w-1.5 h-1.5 bg-brand-gold rounded-full"></div><span>${cleanPart}</span>`;
                        hoursListUl.appendChild(li);
                    }
                });
            }

            // -- Adres ve Maps Linki --
            if (address) {
                document.getElementById('addressText').textContent = address;
            }
            if (mapsLink) {
                const mapsBtn = document.getElementById('mapsBtn');
                mapsBtn.href = mapsLink;
                mapsBtn.classList.remove('hidden');
            }

            // -- Wifi --
            if (wifi) {
                document.getElementById('wifiArea').classList.remove('hidden');
                document.getElementById('wifiText').textContent = wifi;
            }

            // Footer Bilgileri
            const footerDiv = document.getElementById('footerContact');
            footerDiv.innerHTML = ''; 
            if (address) footerDiv.innerHTML += `<span>${address}</span>`;
            if (phone) footerDiv.innerHTML += `<span>Tel: ${phone}</span>`;
        }

        function toggleInfoDetails() {
            const details = document.getElementById('infoDetails');
            const chevron = document.getElementById('infoChevron');
            
            if (details.style.maxHeight) {
                details.style.maxHeight = null;
                details.style.opacity = '0';
                chevron.style.transform = 'rotate(0deg)';
            } else {
                details.style.maxHeight = details.scrollHeight + "px";
                details.style.opacity = '1';
                chevron.style.transform = 'rotate(180deg)';
            }
        }

        // --- KATEGORİ VE MENÜ İŞLEMLERİ ---
        function renderCategories() {
            const nav = document.getElementById('categoryNav');
            nav.innerHTML = '';

            const allBtn = createNavButton('all', 'Tümü', true);
            nav.appendChild(allBtn);

            allCategories.forEach(cat => {
                const btn = createNavButton(cat['KategoriID'], cat['KategoriAdi'], false);
                nav.appendChild(btn);
            });
        }

        function createNavButton(id, name, isActive) {
            const btn = document.createElement('button');
            btn.dataset.id = id;
            
            let classes = "snap-start flex-shrink-0 px-5 py-2 rounded-full text-xs font-bold transition-all duration-300 border border-transparent shadow-sm whitespace-nowrap ";
            if (activeCategoryID === id) {
                classes += "bg-brand-blue text-white shadow-brand-blue/30 scale-105";
            } else {
                classes += "bg-white text-slate-500 border-slate-100 hover:border-brand-blue hover:text-brand-blue";
            }
            btn.className = classes;
            btn.textContent = name;
            
            btn.onclick = () => {
                activeCategoryID = id;
                updateNavStyles();
                renderMenu(id);
                btn.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
            };
            return btn;
        }

        function updateNavStyles() {
            const btns = document.querySelectorAll('#categoryNav button');
            btns.forEach(btn => {
                const isSelected = btn.dataset.id === activeCategoryID;
                if (isSelected) {
                    btn.className = "snap-start flex-shrink-0 px-5 py-2 rounded-full text-xs font-bold transition-all duration-300 border border-transparent shadow-sm whitespace-nowrap bg-brand-blue text-white shadow-brand-blue/30 scale-105";
                } else {
                    btn.className = "snap-start flex-shrink-0 px-5 py-2 rounded-full text-xs font-bold transition-all duration-300 border border-transparent shadow-sm whitespace-nowrap bg-white text-slate-500 border-slate-100 hover:border-brand-blue hover:text-brand-blue";
                }
            });
        }

        function renderMenu(filterCatID) {
            const container = document.getElementById('menuContainer');
            container.innerHTML = ''; 
            
            allCategories.forEach(cat => {
                if (filterCatID !== 'all' && cat['KategoriID'] !== filterCatID) return;

                const categoryProducts = allProducts.filter(p => p['KategoriID'] === cat['KategoriID']);
                const visibleProducts = categoryProducts.filter(p => {
                    if (!p['AktifDurum']) return true;
                    return String(p['AktifDurum']).trim().toUpperCase() === 'FALSE';
                });

                if (visibleProducts.length === 0) return;

                const section = document.createElement('div');
                section.className = "mb-8 fade-in-up";

                if (filterCatID === 'all') {
                    const header = document.createElement('div');
                    header.className = "flex items-center gap-2 mb-4 px-1";
                    header.innerHTML = `
                        <div class="w-1 h-4 bg-brand-gold rounded-full"></div>
                        <h2 class="text-lg font-bold text-brand-dark">${cat['KategoriAdi']}</h2>
                    `;
                    section.appendChild(header);
                }

                const grid = document.createElement('div');
                grid.className = "grid grid-cols-1 md:grid-cols-2 gap-4";

                visibleProducts.forEach(prod => {
                    let rawImgUrl = prod['ResimLinki'];
                    let imgUrl = (rawImgUrl && rawImgUrl.length > 5) 
                        ? convertGoogleDriveLink(rawImgUrl) 
                        : 'https://via.placeholder.com/150?text=Resim+Yok';

                    const price = prod['UrunFiyati'] ? `${prod['UrunFiyati']} ₺` : '';
                    const hasDesc = prod['Aciklama'] && String(prod['Aciklama']).trim().length > 0;
                    
                    const card = document.createElement('div');
                    card.className = "group bg-white rounded-2xl p-3 border border-slate-100 shadow-soft hover:shadow-md transition-all duration-300 flex gap-4 overflow-hidden relative cursor-pointer";
                    
                    card.onclick = () => openModal('productModal', {
                        title: prod['UrunAdi'],
                        desc: prod['Aciklama'],
                        price: price,
                        img: imgUrl
                    });

                    card.innerHTML = `
                        <div class="w-24 h-24 flex-shrink-0 rounded-xl overflow-hidden bg-slate-100 relative shadow-inner">
                            <img src="${imgUrl}" alt="${prod['UrunAdi']}" class="w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-500" loading="lazy" referrerpolicy="no-referrer">
                        </div>
                        <div class="flex flex-col justify-center flex-1 min-w-0 py-1">
                            <h3 class="text-slate-800 font-bold text-base leading-tight mb-1 truncate pr-4">${prod['UrunAdi']}</h3>
                            ${price ? `<div class="text-brand-blue font-bold text-sm mb-1">${price}</div>` : ''}
                            ${hasDesc ? `<p class="text-slate-500 text-xs leading-relaxed line-clamp-2">${prod['Aciklama']}</p>` : ''}
                            ${hasDesc ? '<div class="text-[10px] text-slate-400 mt-1 font-medium">Detay için dokun</div>' : ''}
                        </div>
                        <div class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-200 group-hover:text-brand-gold transition-colors duration-300">
                            <i class="fas fa-chevron-right text-xs"></i>
                        </div>
                    `;
                    grid.appendChild(card);
                });

                section.appendChild(grid);
                container.appendChild(section);
            });

            if (container.innerHTML === '') {
                container.innerHTML = `
                    <div class="flex flex-col items-center justify-center py-16 text-center">
                        <div class="w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mb-4 text-slate-300">
                            <i class="fas fa-search text-2xl"></i>
                        </div>
                        <h3 class="text-slate-600 font-bold">Ürün Bulunamadı</h3>
                        <p class="text-slate-400 text-xs mt-1">Bu kategoride henüz aktif ürün yok.</p>
                    </div>
                `;
            }
        }

        // --- MODAL YÖNETİMİ ---
        function openInfoModal() {
            const modal = document.getElementById('infoModal');
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function openModal(modalId, data = null) {
            const modal = document.getElementById(modalId);
            
            if (modalId === 'productModal' && data) {
                document.getElementById('modalTitle').textContent = data.title;
                document.getElementById('modalDesc').textContent = data.desc || 'Bu ürün için açıklama bulunmuyor.';
                document.getElementById('modalPrice').textContent = data.price;
                
                const modalImg = document.getElementById('modalImage');
                modalImg.src = data.img;
                modalImg.onerror = function() {
                    this.src = 'https://via.placeholder.com/500?text=Resim+Yuklenemedi';
                };
            }

            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
            document.body.style.overflow = 'auto';
        }
    </script>
</body>
</html>
